{{ define "main" }}
  {{ $risk_levels := .Site.Data.risk_levels }}


  <header style="border: 1px solid lightgray">
    <h1>{{ .Date.Format "02 January, 2006" }}</h1>

    {{ with .Params.overall_risk }}
      <div style="width: 100px;">
        <img
          style="max-width: 100%; height: auto;"
          src="{{ (index $risk_levels .).img }}"
          alt="Overall risk level: {{ . }}"
        />
      </div>
      <h2>Overall: {{ partial "risk_level" . }}</h2>
    {{ end }}

    {{ with .Params.post }}
      <div style="padding: 10px; background: #eee">{{ . | markdownify }}</div>
    {{ end }}


    <p>Valid until: {{ (.Date.AddDate 0 0 1).Format "02 January, 2006" }}</p>
  </header>

  {{ with .Params.elevation_risk }}
    {{ if and (.alpine) (.tree_line) (.below_tree_line) }}
      <div style="border: 1px solid lightgray">
        <h3>Avalanche danger by elevation</h3>
        <div style="display:flex; align-items: center">
          <h4 style="width: 115px">Alpine</h4>
          <div style="width: 100px">
            <img
              style="max-width: 100%; height: auto;"
              src="{{ (index $risk_levels .alpine).img }}"
              alt="Alpine risk level: {{ .alpine }}"
            />
          </div>
          <figure style="width: 200px">
            {{ partial "graphics/elevation_risk.svg" (dict "zone" "alp" "risk" .alpine) }}
          </figure>
          <div>
            <p>{{ partial "risk_level" .alpine }}</p>
            <p>{{ (index $risk_levels .alpine).advice }}</p>
          </div>
        </div>

        <div style="display:flex; align-items: center">
          <h4 style="width: 115px">Tree Line</h4>
          <div style="width: 100px">
            <img
              style="max-width: 100%; height: auto;"
              src="{{ (index $risk_levels .tree_line).img }}"
              alt="Tree line risk level: {{ .tree_line }}"
            />
          </div>
          <figure style="width: 200px">
            {{ partial "graphics/elevation_risk.svg" (dict "zone" "trl" "risk" .tree_line) }}
          </figure>
          <div>
            <p>{{ partial "risk_level" .tree_line }}</p>
            <p>{{ (index $risk_levels .tree_line).advice }}</p>
          </div>
        </div>
        <div style="display:flex; align-items: center">
          <h4 style="width: 115px">Below Tree Line</h4>
          <div style="width: 100px">
            <img
              style="max-width: 100%; height: auto;"
              src="{{ (index $risk_levels .below_tree_line).img }}"
              alt="Below tree line risk level: {{ .below_tree_level }}"
            />
          </div>
          <figure style="width: 200px">
            {{ partial "graphics/elevation_risk.svg" (dict "zone" "btl" "risk" .below_tree_line) }}
          </figure>
          <div>
            <p>{{ partial "risk_level" .below_tree_line }}</p>
            <p>{{ (index $risk_levels .below_tree_line).advice }}</p>
          </div>
        </div>
      </div>
    {{ end }}
  {{ end }}

  {{ with .Params.avalanche_problems }}
    <div style="border: 1px solid lightgray">
      <h3>Avalanche Problems</h3>
      {{ range $i, $node := . }}
        {{ $imgpath := (index site.Data.avalanche_problems "Cornice Fall").img }}
        <div>
          <h4>Avalanche Problem #{{ add 1 $i }}: {{ $node.problem }}</h4>
          <img src="{{ $imgpath }}" alt="{{ $node.problem }}" />
          {{ with $node.description }}
            <div style="padding: 10px; background: #eee">
              <p>{{ . }}</p>
            </div>
          {{ end }}
          {{ with $node.trend }}<p>Trend: {{ $node.trend }}</p>{{ end }}
        </div>
      {{ end }}
    </div>
  {{ end }}

{{ end }}
